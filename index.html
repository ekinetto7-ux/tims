<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>運転支援システム</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:sans-serif;
}

/* ===== 固定ボタン ===== */
#homeBtn{
  position:fixed;
  top:10px;
  right:10px;
  z-index:500;
  padding:10px 16px;
  font-size:16px;
}
.hidden{display:none;}

/* ===== 画面 ===== */
.screen{
  display:none;
  height:100vh;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.screen.active{display:flex;}

.select-title{
  font-size:26px;
  color:#ccc;
  margin-bottom:30px;
}

.select-buttons{
  display:flex;
  gap:30px;
}

.select-btn{
  width:180px;
  height:90px;
  background:#111;
  border:2px solid #555;
  color:#fff;
  font-size:22px;
}

/* ===== 状態表示 ===== */
#status{
  font-size:24px;
  margin:20px;
}
.normal{color:#0f0;}
.emergency{color:red;font-weight:bold;}

/* ===== ボタン ===== */
button{cursor:pointer;}
.red{
  background:#c00;
  color:#fff;
  font-size:22px;
  padding:16px 30px;
}
.yellow{
  background:#ffd800;
  color:#000;
  font-size:22px;
  padding:16px 30px;
}

/* ===== overlay ===== */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:300;
}
.overlay.active{display:flex;}

.box{
  border:2px solid red;
  padding:30px;
  max-width:520px;
  background:#000;
  text-align:center;
}
.box p{
  color:red;
  font-size:20px;
}

/* 点滅 */
.blink{
  animation: blink 1s infinite;
}
@keyframes blink{
  0%{opacity:1;}
  50%{opacity:0;}
  100%{opacity:1;}
}
</style>
</head>

<body>

<button id="homeBtn" onclick="goHome()">初期選択</button>

<!-- 初期選択 -->
<div id="initialScreen" class="screen active">
  <div class="select-title">初期選択</div>
  <div class="select-buttons">
    <button class="select-btn" onclick="enterMain()">運転士</button>
    <button class="select-btn" onclick="enterMain()">車掌</button>
    <button class="select-btn" onclick="enterMain()">ワンマン</button>
  </div>
</div>

<!-- 運転情報 -->
<div id="mainScreen" class="screen">
  <div id="status" class="normal">平常運転しています</div>
  <button class="red" onclick="emergencyButton()">非常</button>
</div>

<!-- 非常理由 -->
<div id="reasonOverlay" class="overlay">
  <div class="box">
    <p>非常理由を選択</p>
    <button onclick="startEmergency('人身事故')">人身事故</button><br><br>
    <button onclick="startEmergency('地震')">地震</button><br><br>
    <button onclick="startEmergency('線路内侵入')">線路内侵入</button><br><br>
    <button onclick="startEmergency('火災')">火災</button>
  </div>
</div>

<!-- 非常表示 -->
<div id="messageOverlay" class="overlay">
  <div class="box">
    <p id="emergencyText" class="blink"></p>
  </div>
</div>

<!-- 解除確認 -->
<div id="releaseOverlay" class="overlay">
  <div class="box">
    <p>非常を解除します。よろしいですか</p>
    <button class="yellow" onclick="releaseEmergency()">非常解除</button>
  </div>
</div>

<script>
/* ===== 状態 ===== */
let emergencyState = "normal"; // normal / active / confirm

function hideAllOverlays(){
  document.querySelectorAll(".overlay")
    .forEach(o => o.classList.remove("active"));
}

function showScreen(id){
  hideAllOverlays();
  document.querySelectorAll(".screen")
    .forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function enterMain(){
  showScreen("mainScreen");
}

function goHome(){
  if(emergencyState !== "normal") return;
  showScreen("initialScreen");
}

/* ===== 非常 ===== */
function emergencyButton(){
  if(emergencyState === "normal"){
    hideAllOverlays();
    document.getElementById("reasonOverlay").classList.add("active");
  }
  else if(emergencyState === "active"){
    hideAllOverlays();
    document.getElementById("releaseOverlay").classList.add("active");
    emergencyState = "confirm";
  }
}

function startEmergency(reason){
  emergencyState = "active";
  hideAllOverlays();

  document.getElementById("homeBtn").classList.add("hidden");

  const status = document.getElementById("status");
  status.textContent = "非常モードです。安全を確認してください";
  status.className = "emergency";

  document.getElementById("emergencyText").textContent =
    reason + "：\n" + messageFor(reason);

  document.getElementById("messageOverlay").classList.add("active");
}

function releaseEmergency(){
  emergencyState = "normal";
  hideAllOverlays();

  const status = document.getElementById("status");
  status.textContent = "平常運転しています";
  status.className = "normal";

  document.getElementById("homeBtn").classList.remove("hidden");
  showScreen("mainScreen");
}

function messageFor(r){
  return {
    "人身事故":"直ちに、消防・警察・車掌に連絡すること",
    "地震":"直ちに高台に避難。車掌と連携し指令に報告",
    "線路内侵入":"直ちに他の列車に連絡。警察にも連絡",
    "火災":"窓を閉め、乗客を安全な場所に避難。トンネル内停車を避けること"
  }[r];
}
</script>

</body>
</html>
