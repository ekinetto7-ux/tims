<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>TIMS 再現システム</title>

<style>
body{
  margin:0;
  background:#000;
  color:#0f0;
  font-family:monospace;
}

/* ===== ヘッダ ===== */
header{
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
  border-bottom:2px solid #0f0;
}

.route-yellow{ color:yellow; font-weight:bold; }
.route-blue{ color:#4fc3f7; font-weight:bold; }

.blink{ animation:blink 1s infinite; }
@keyframes blink{ 50%{opacity:0;} }

/* ===== 画面 ===== */
.nav{
  display:flex;
  gap:10px;
  padding:10px;
}

button{
  padding:12px 18px;
  font-size:15px;
  border:none;
  cursor:pointer;
}

.gray{ background:#333; color:#fff; }
.blue{ background:#1e90ff; color:#fff; }
.red{ background:red; color:#fff; }

button:disabled{ opacity:.4; cursor:not-allowed; }

.screen{ display:none; padding:15px; }
.screen.active{ display:block; }

/* ===== 車両 ===== */
.train{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-bottom:15px;
}

.car{
  width:42px;
  height:26px;
  border:2px solid #0f0;
  background:#000;
  color:#0f0;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.car.open{
  background:red;
  color:#fff;
}

.car.disabled{
  opacity:.4;
  pointer-events:none;
}
</style>
</head>

<body>

<header>
  <div id="route" class="route-yellow">内房線</div>
  <div id="station">君津</div>
</header>

<div class="nav">
  <button class="gray" onclick="showScreen('drive')">運転情報</button>
  <button class="gray" onclick="showScreen('conductor')">車掌</button>
</div>

<!-- 運転情報画面 -->
<div id="drive" class="screen active">
  <div class="train" id="driveCars"></div>
  <button class="blue" id="nextBtn">次の駅</button>
  <button class="red" id="emergencyBtn">非常</button>
</div>

<!-- 車掌画面 -->
<div id="conductor" class="screen">
  <div class="train" id="condCars"></div>
</div>

<script>
/* ===== 駅 ===== */
const stations=[
"君津","木更津","袖ケ浦","長浦","姉ケ崎","五井",
"八幡宿","浜野","蘇我","千葉",
"稲毛","津田沼","船橋","市川",
"新小岩","錦糸町","馬喰町","新日本橋","東京"
];

let idx=0;
let locked=false;

/* ===== 音 ===== */
function beep(){
 const c=new AudioContext();
 const o=c.createOscillator();
 o.frequency.value=1200;
 o.connect(c.destination);
 o.start();
 o.stop(c.currentTime+0.08);
}

function chime(){
 const c=new AudioContext();
 [880,660].forEach((f,i)=>{
   const o=c.createOscillator();
   o.frequency.value=f;
   o.connect(c.destination);
   o.start(c.currentTime+i*0.3);
   o.stop(c.currentTime+i*0.3+0.4);
 });
}

/* ===== 車両 ===== */
const cars=[...Array(11).keys()].map(i=>i+1).concat(["増1","増2","増3","増4"]);
const driveCars=document.getElementById("driveCars");
const condCars=document.getElementById("condCars");

let doorState={};
cars.forEach(c=>doorState[c]=false);

function createCar(c,parent){
 const d=document.createElement("div");
 d.className="car";
 d.textContent=c;

 d.onclick=()=>{
  if(locked) return;
  beep();

  if(String(c).includes("増")){
    const newState=!doorState[c];
    cars.filter(x=>String(x).includes("増")).forEach(x=>doorState[x]=newState);
  }else{
    doorState[c]=!doorState[c];
  }
  renderDoors();
 };
 parent.appendChild(d);
}

cars.forEach(c=>createCar(c,driveCars));
cars.forEach(c=>createCar(c,condCars));

function renderDoors(){
 document.querySelectorAll(".car").forEach(el=>{
  const c=el.textContent;
  el.classList.toggle("open",doorState[c]);
 });
}

/* ===== 画面切替 ===== */
function showScreen(id){
 if(locked) return;
 beep();
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

/* ===== 次の駅 ===== */
nextBtn.onclick=()=>{
 if(locked) return;
 beep();
 idx++;
 if(idx>=stations.length) return;

 station.textContent=stations[idx];

 if(stations[idx]==="千葉"){
   route.textContent="総武快速線";
   route.classList.remove("route-yellow");
   route.classList.add("route-blue");
   chime(); chime();
 }

 if(stations[idx]==="東京"){
   route.classList.add("blink");
   station.classList.add("blink");
   lockAll();
 }
};

/* ===== 非常 ===== */
emergencyBtn.onclick=()=>{
 beep();
 lockAll();
};

/* ===== 全ロック ===== */
function lockAll(){
 locked=true;
 document.querySelectorAll(".car").forEach(c=>c.classList.add("disabled"));
 document.querySelectorAll("button").forEach(b=>b.disabled=true);
}
</script>

</body>
</html>
