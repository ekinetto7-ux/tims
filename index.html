<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>運転支援システム</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:sans-serif;
}

.hidden{display:none;}

button{
  cursor:pointer;
  border:none;
  border-radius:6px;
  font-family:sans-serif;
}

/* 共通画面 */
.screen{
  display:none;
  height:100vh;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.screen.active{display:flex;}

/* 初期選択 */
#initialScreen button{
  width:220px;
  height:100px;
  font-size:26px;
  background:#111;
  color:#fff;
  border:2px solid #666;
  margin:12px;
}

/* 右上固定 */
#homeBtn{
  position:fixed;
  top:10px;
  right:10px;
  z-index:500;
  padding:12px 20px;
  font-size:18px;
  background:#222;
  color:#fff;
  border:2px solid #666;
}

/* 運転情報 */
#infoBox{
  border:2px solid #444;
  padding:30px 50px;
  margin-bottom:30px;
  text-align:center;
}

.normal{color:#0f0;}
.emergency{color:red;font-weight:bold;}

.red{
  background:#c00;
  color:#fff;
  font-size:26px;
  padding:20px 50px;
  border:2px solid #ff6666;
}

.yellow{
  background:#ffd800;
  color:#000;
  font-size:26px;
  padding:20px 50px;
  border:2px solid #fff3a0;
  margin-top:30px;
}

/* 半自動 */
#semiAutoButtons{
  display:flex;
  gap:40px;
  margin-top:20px;
}

.semiBtn{
  width:120px;
  height:160px;
  font-size:24px;
  background:#111;
  color:#fff;
  border:2px solid #666;
}

#semiAutoIndicator{
  margin-top:20px;
}

.lamp{
  font-size:20px;
  color:#666;
}
.lamp.active{
  color:#0f0;
  font-weight:bold;
}

/* オーバーレイ */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:300;
}
.overlay.active{display:flex;}

.box{
  border:2px solid red;
  padding:30px;
  max-width:520px;
  background:#000;
  text-align:center;
}

.blink{
  animation: blink 1s infinite;
}
@keyframes blink{
  0%{opacity:1;}
  50%{opacity:0;}
  100%{opacity:1;}
}

/* ドア */
.doorBtn{
  width:200px;
  height:100px;
  font-size:28px;
  background:#111;
  color:#fff;
  border:2px solid #666;
}
.doorDisabled{opacity:0.4;}
</style>
</head>

<body>

<button id="homeBtn" onclick="goHome()">初期選択</button>

<!-- 初期選択 -->
<div id="initialScreen" class="screen active">
  <h2>初期選択</h2>
  <button onclick="enterMain('driver')">運転士</button>
  <button onclick="enterMain('conductor')">車掌</button>
  <button onclick="enterMain('oneMan')">ワンマン</button>
</div>

<!-- 運転士・車掌 -->
<div id="mainScreen" class="screen">
  <div id="infoBox">
    <div>路線：内房線</div>
    <div>区間：君津 → 東京</div>
    <div id="status" class="normal">状態：平常運転</div>
  </div>

  <div id="semiAutoButtons">
    <button class="semiBtn" onclick="semiAutoOn()">半自動 入</button>
    <button class="semiBtn" onclick="semiAutoOff()">半自動 切</button>
  </div>

  <div id="semiAutoIndicator">
    <div id="semiOnLamp" class="lamp">半自動 ON</div>
    <div id="semiOffLamp" class="lamp active">半自動 OFF</div>
  </div>

  <br>
  <button class="red" onclick="pressEmergency()">非常</button>
</div>

<!-- ワンマン -->
<div id="oneManScreen" class="screen">
  <div id="infoBox">
    <div>路線：内房線（ワンマン）</div>
    <div>区間：君津 → 東京</div>
    <div id="statusOneMan" class="normal">状態：平常運転</div>
  </div>

  <button onclick="openDoorMenu()">ドア開閉</button><br><br>
  <button class="red" onclick="pressEmergency()">非常</button>
</div>

<!-- ドアメニュー -->
<div id="doorMenuScreen" class="screen">
  <div id="doorStatus">ドア：閉</div><br>
  <button class="doorBtn" onclick="doorOpen()">ドア開</button><br><br>
  <button class="doorBtn" onclick="doorClose()">ドア閉</button><br><br>
  <button onclick="backToOneMan()">戻る</button>
</div>

<!-- 非常理由 -->
<div id="reasonOverlay" class="overlay">
  <div class="box">
    <p>非常理由を選択</p>
    <button onclick="startEmergency('人身事故')">人身事故</button><br><br>
    <button onclick="startEmergency('地震')">地震</button><br><br>
    <button onclick="startEmergency('線路内侵入')">線路内侵入</button><br><br>
    <button onclick="startEmergency('火災')">火災</button>
  </div>
</div>

<!-- 非常表示 -->
<div id="messageOverlay" class="overlay">
  <div class="box">
    <p id="emergencyText" class="blink"></p>
    <button class="yellow" onclick="releaseEmergency()">非常解除</button>
  </div>
</div>

<script>
let role="";
let emergency=false;
let semiAuto=false;
let doorState="closed";

function hideAll(){
  document.querySelectorAll('.overlay').forEach(o=>o.classList.remove("active"));
}

function enterMain(r){
  role=r;
  document.getElementById("initialScreen").classList.remove("active");
  (r==="oneMan"?oneManScreen:mainScreen).classList.add("active");
}

function goHome(){
  if(emergency) return;
  mainScreen.classList.remove("active");
  oneManScreen.classList.remove("active");
  doorMenuScreen.classList.remove("active");
  initialScreen.classList.add("active");
}

function pressEmergency(){
  if(emergency){
    messageOverlay.classList.add("active");
    return;
  }
  reasonOverlay.classList.add("active");
}

function startEmergency(reason){
  emergency=true;
  hideAll();
  homeBtn.classList.add("hidden");

  if(role==="oneMan"){
    statusOneMan.textContent="状態：非常";
    statusOneMan.className="emergency";
  }else{
    status.textContent="状態：非常";
    status.className="emergency";
  }

  emergencyText.textContent = reason + "：対応を行ってください";
  messageOverlay.classList.add("active");

  semiAuto=false;
  updateSemi();
}

function releaseEmergency(){
  emergency=false;
  hideAll();
  homeBtn.classList.remove("hidden");

  if(role==="oneMan"){
    statusOneMan.textContent="状態：平常運転";
    statusOneMan.className="normal";
  }else{
    status.textContent="状態：平常運転";
    status.className="normal";
  }
}

function semiAutoOn(){ if(!emergency){semiAuto=true;updateSemi();}}
function semiAutoOff(){ if(!emergency){semiAuto=false;updateSemi();}}

function updateSemi(){
  semiOnLamp.classList.toggle("active",semiAuto);
  semiOffLamp.classList.toggle("active",!semiAuto);
}

function openDoorMenu(){
  if(emergency) return;
  oneManScreen.classList.remove("active");
  doorMenuScreen.classList.add("active");
}

function backToOneMan(){
  doorMenuScreen.classList.remove("active");
  oneManScreen.classList.add("active");
}

function doorOpen(){
  if(emergency||semiAuto) return;
  doorState="open";
  doorStatus.textContent="ドア：開";
}
function doorClose(){
  if(emergency||semiAuto) return;
  doorState="closed";
  doorStatus.textContent="ドア：閉";
}
</script>

</body>
</html>
