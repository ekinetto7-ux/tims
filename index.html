<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>TIMS 完成版</title>

<style>
/* ===== 全体 ===== */
body{
  margin:0;
  background:#000;
  color:#ffd400;
  font-family: monospace;
}
.wrapper{
  width:1280px;
  transform-origin: top left;
}
@media(max-width:1280px){
  .wrapper{ transform:scale(calc(100vw/1280)); }
}

/* ===== 上段 ===== */
.topbar{
  display:flex;
  justify-content:space-between;
  padding:6px 10px;
  font-size:20px;
  border-bottom:3px solid #ffd400;
}

/* ===== 路線表示 ===== */
.line{
  font-size:28px;
  margin:10px;
}
.uchibo{ color:#ffd400; }
.sobu{ color:#00aaff; }
.terminal{
  color:#fff;
  animation: blink 1s steps(1) infinite;
}
@keyframes blink{50%{opacity:0;}}

/* ===== 駅一覧 ===== */
.station-window{
  height:360px;
  overflow:hidden;
  margin-left:10px;
}
#stationList{
  transition:transform .4s ease;
}
.station{
  font-size:28px;
  line-height:44px;
}
.station.current{
  background:#1e3a5f;
  font-size:30px;
  font-weight:bold;
}

/* ===== 編成・ドア ===== */
.doors{
  display:flex;
  gap:6px;
  margin:10px;
}
.car{
  display:flex;
  flex-direction:column;
  align-items:center;
}
.car-num{
  font-size:14px;
  color:#00ff66;
}
.door{
  width:30px;
  height:14px;
  background:#000;
  border:1px solid #ffd400;
}
.door.open{ background:red; }

/* ===== ボタン ===== */
.controls{
  margin:10px;
}
button{
  background:#000;
  color:#ffd400;
  border:1px solid #ffd400;
  padding:6px 12px;
  margin-right:6px;
}
</style>
</head>

<body>
<div class="wrapper">

  <!-- 上段 -->
  <div class="topbar">
    <div id="time">--:--:--</div>
    <div id="lineName" class="uchibo">内房線</div>
    <div>0.0 km/h</div>
  </div>

  <!-- 駅一覧 -->
  <div class="station-window">
    <div id="stationList"></div>
  </div>

  <!-- 編成 -->
  <div class="doors" id="doors"></div>

  <!-- 操作 -->
  <div class="controls">
    <button onclick="toggleRun()">走行/停車</button>
    <button onclick="nextStation()">進駅</button>
  </div>

</div>

<!-- 効果音 -->
<audio id="chime" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
/* ===== 停車駅 ===== */
const stations=[
 "君津","木更津","袖ヶ浦","長浦","姉ヶ崎","五井",
 "八幡宿","浜野","蘇我","本千葉","千葉",
 "津田沼","船橋","市川","新小岩","錦糸町",
 "新日本橋","東京"
];
let currentIndex=0;
let running=false;
let locked=false;

/* ===== 初期生成 ===== */
const stationList=document.getElementById("stationList");
stations.forEach(s=>{
  const d=document.createElement("div");
  d.className="station";
  d.textContent=s;
  stationList.appendChild(d);
});

/* 編成15両 */
const doors=document.getElementById("doors");
for(let i=1;i<=15;i++){
  doors.innerHTML+=`
   <div class="car">
     <div class="car-num">${i}</div>
     <div class="door"></div>
   </div>`;
}

/* ===== 表示更新 ===== */
function render(){
  document.querySelectorAll(".station").forEach((s,i)=>{
    s.classList.toggle("current",i===currentIndex);
  });

  // 自動スクロール
  const top=Math.max(0,currentIndex-4);
  stationList.style.transform=`translateY(${-top*44}px)`;

  // 路線表示
  const ln=document.getElementById("lineName");
  if(currentIndex<10){
    ln.textContent="内房線";
    ln.className="uchibo";
  }else if(currentIndex<stations.length-1){
    ln.textContent="総武快速線";
    ln.className="sobu";
  }else{
    ln.textContent="終点";
    ln.className="terminal";
  }
}

/* ===== ドア ===== */
function updateDoors(){
  document.querySelectorAll(".door").forEach(d=>{
    d.classList.toggle("open",!running);
  });
}

/* ===== 操作 ===== */
function toggleRun(){
  if(locked) return;
  running=!running;
  updateDoors();
}
function nextStation(){
  if(locked) return;
  if(currentIndex<stations.length-1){
    running=true;
    updateDoors();
    setTimeout(()=>{
      currentIndex++;
      running=false;
      updateDoors();

      if(stations[currentIndex]==="千葉"){
        play("chime");setTimeout(()=>play("chime"),300);
      }
      if(stations[currentIndex]==="東京"){
        locked=true;
      }
      render();
    },800);
  }
}

/* ===== 音 ===== */
function play(id){
  const a=document.getElementById(id);
  a.currentTime=0;a.play();
}

/* ===== 時計 ===== */
setInterval(()=>{
  document.getElementById("time").textContent=
    new Date().toLocaleTimeString();
},1000);

/* 初期 */
render();
updateDoors();
</script>
</body>
</html>
