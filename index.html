<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TIMS 模擬</title>
<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    background: #0b0f14;
    color: #eaeaea;
  }
  .screen { display: none; padding: 16px; }
  .screen.active { display: block; }

  h1 { margin: 0 0 12px; font-size: 20px; }
  .menu {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }
  .btn {
    padding: 14px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    background: #2a2f3a;
    color: #fff;
  }
  .btn.primary { background: #3b82f6; }
  .btn.warn { background: #ef4444; }
  .btn.yellow { background: #f59e0b; color: #000; }
  .btn.big { font-size: 20px; padding: 20px; }

  .top-right {
    position: fixed; top: 10px; right: 10px;
  }
  .bottom-right {
    position: fixed; bottom: 10px; right: 10px;
  }
  .bottom-center {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
  }

  /* 非常表示 */
  .overlay {
    position: fixed; inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    pointer-events: none;
  }
  .overlay.active { display: flex; }
  .emergency-text {
    text-align: center;
    font-size: 28px;
    font-weight: 800;
    color: red;
    animation: blink 1s step-start infinite;
  }
  @keyframes blink { 50% { opacity: 0; } }

  .confirm {
    position: fixed; inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1100;
    background: rgba(0,0,0,.6);
  }
  .confirm.active { display: flex; }
  .confirm-box {
    background: #111827;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: min(90%, 360px);
  }
  .confirm-box p {
    color: #f59e0b;
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 16px;
  }

  .status { margin: 8px 0; }
  .status.ok { color: #22c55e; }
  .list { line-height: 1.8; }

  .log-item { margin-bottom: 8px; }
  .log-time { color: #9ca3af; font-size: 12px; }

</style>
</head>
<body>

<!-- 非常オーバーレイ -->
<div id="emergencyOverlay" class="overlay">
  <div class="emergency-text">
    非常モードです。<br/>安全を確認してください
  </div>
</div>

<!-- 非常解除確認 -->
<div id="confirmOverlay" class="confirm">
  <div class="confirm-box">
    <p>非常を解除しますか</p>
    <button class="btn warn big" onclick="releaseEmergency()">非常解除</button>
  </div>
</div>

<!-- 初期選択 -->
<div id="home" class="screen active">
  <h1>初期選択</h1>
  <div class="menu">
    <button class="btn primary" onclick="go('driverMenu')">運転士</button>
    <button class="btn primary" onclick="go('conductorMenu')">車掌</button>
    <button class="btn primary" onclick="go('oneManMenu')">ワンマン</button>
  </div>
</div>

<!-- 運転士メニュー -->
<div id="driverMenu" class="screen">
  <h1>運転士メニュー</h1>
  <div class="menu">
    <button class="btn" onclick="go('operationInfo')">運転情報</button>
    <button class="btn" onclick="go('log')">非常履歴</button>
  </div>
</div>

<!-- 車掌メニュー -->
<div id="conductorMenu" class="screen">
  <h1>車掌メニュー</h1>
  <div class="menu">
    <button class="btn" onclick="go('operationInfo')">運転情報</button>
    <button class="btn" onclick="go('log')">非常履歴</button>
  </div>
</div>

<!-- ワンマンメニュー -->
<div id="oneManMenu" class="screen">
  <h1>ワンマンメニュー</h1>
  <div class="menu">
    <button class="btn" onclick="go('oneManDoor')">ドア開閉</button>
    <button class="btn" onclick="go('operationInfo')">運転情報</button>
    <button class="btn" onclick="go('log')">非常履歴</button>
  </div>
</div>

<!-- ワンマン ドア -->
<div id="oneManDoor" class="screen">
  <h1>ドア開閉</h1>
  <div class="menu">
    <button class="btn big" onclick="alert('ドア開')">ドア開</button>
    <button class="btn big" onclick="alert('ドア閉')">ドア閉</button>
  </div>
</div>

<!-- 運転情報 -->
<div id="operationInfo" class="screen">
  <h1>運転情報</h1>
  <div id="opStatus" class="status ok">平常運転しています</div>
  <div class="list">
    停車駅：<br/>
    君津 → 木更津 → 袖ヶ浦 → 長浦 → 姉ヶ崎 → 五井 → 八幡宿 → 浜野 → 蘇我 →
    本千葉 → 千葉 → 津田沼 → 船橋 → 市川 → 新小岩 → 馬喰町 → 新日本橋 → 東京
  </div>
</div>

<!-- 非常履歴 -->
<div id="log" class="screen">
  <h1>非常履歴</h1>
  <div id="logList"></div>
</div>

<!-- 共通ボタン -->
<div class="top-right">
  <button class="btn" onclick="go('home')">初期選択</button>
</div>
<div class="bottom-right">
  <button class="btn warn big" onclick="emergencyPress()">非常</button>
</div>
<div class="bottom-center">
  <button class="btn" onclick="go('oneManDoor')">ドア操作へ</button>
</div>

<script>
  let emergency = false;
  let logs = [];

  function go(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function now(){
    const d = new Date();
    return d.toLocaleTimeString();
  }

  function emergencyPress(){
    if(!emergency){
      emergency = true;
      logs.push({type:'発生', time: now()});
      document.getElementById('emergencyOverlay').classList.add('active');
      document.getElementById('opStatus').textContent = '非常扱い';
      document.getElementById('opStatus').className = 'status';
      document.getElementById('opStatus').style.color = 'red';
    } else {
      document.getElementById('confirmOverlay').classList.add('active');
    }
  }

  function releaseEmergency(){
    emergency = false;
    logs.push({type:'解除', time: now()});
    document.getElementById('confirmOverlay').classList.remove('active');
    document.getElementById('emergencyOverlay').classList.remove('active');
    document.getElementById('opStatus').textContent = '平常運転しています';
    document.getElementById('opStatus').className = 'status ok';
    renderLog();
  }

  function renderLog(){
    const box = document.getElementById('logList');
    box.innerHTML = '';
    logs.forEach(l=>{
      const d = document.createElement('div');
      d.className = 'log-item';
      d.innerHTML = `・非常${l.type}<div class="log-time">時刻：${l.time}</div>`;
      box.appendChild(d);
    });
  }
</script>
</body>
</html>
