<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>運転支援システム</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:sans-serif;
}

button{
  background:#111;
  color:#fff;
  border:1px solid #555;
  padding:14px 22px;
  font-size:18px;
}

#homeBtn{
  position:fixed;
  top:10px;
  right:10px;
  z-index:1000;
}

.screen{
  display:none;
  height:100vh;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.screen.active{display:flex;}

.box{
  border:1px solid #555;
  padding:20px;
  text-align:center;
}

#status{color:#0f0; font-size:20px; margin-bottom:20px;}

.redBtn{
  background:#c00;
  font-size:24px;
  padding:20px 40px;
}

.yellowText{color:#ff0;}
.whiteText{color:#fff;}
.blueText{color:#4af;}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:500;
}
.overlay.active{display:flex;}

.reasonBtn{
  font-size:22px;
  padding:18px 30px;
  margin:8px;
}

.bigVertical{
  width:120px;
  height:120px;
  font-size:22px;
}

.fade{
  opacity:0;
}
</style>
</head>

<body>

<button id="homeBtn" onclick="goHome()">初期選択</button>

<!-- 初期 -->
<div id="initial" class="screen active">
  <h2>初期選択</h2>
  <button onclick="enterMain('driver')">運転士</button>
  <button onclick="enterMain('conductor')">車掌</button>
  <button onclick="enterMain('one')">ワンマン</button>
</div>

<!-- メイン -->
<div id="main" class="screen">
  <div class="box">
    <div>路線：内房線・総武快速線</div>
    <div>区間：君津 → 東京</div>
    <div>種別：快速</div>
    <div id="status">平常運転</div>
  </div>

  <div id="nextArea" style="margin-top:20px;">
    <div id="nextStation" class="yellowText" style="font-size:22px;"></div>
    <div id="threeStations" class="whiteText" style="margin-top:10px;"></div>
    <div id="tempStatus"></div>
  </div>

  <button onclick="nextStation()" style="margin-top:20px;">次駅</button>

  <div style="margin-top:20px;">
    <button class="bigVertical" onclick="semiOn()">半自動入</button>
    <button class="bigVertical" onclick="semiOff()">半自動切</button>
    <div id="semiState" style="margin-top:10px;color:#0f0;">半自動 OFF</div>
  </div>

  <button class="redBtn" style="margin-top:30px;" onclick="openReason()">非常</button>
</div>

<!-- 非常理由 -->
<div id="reasonOverlay" class="overlay">
  <div class="box">
    <button class="reasonBtn" onclick="startEmergency('人身事故')">人身事故</button><br>
    <button class="reasonBtn" onclick="startEmergency('地震')">地震</button><br>
    <button class="reasonBtn" onclick="startEmergency('線路内侵入')">線路内侵入</button><br>
    <button class="reasonBtn" onclick="startEmergency('火災')">火災</button>
  </div>
</div>

<!-- 非常表示 -->
<div id="emergencyOverlay" class="overlay">
  <div class="box">
    <div id="emText" style="color:red;font-size:22px;"></div>
    <button style="background:#ffd800;color:#000;font-size:22px;margin-top:20px;"
      onclick="confirmRelease()">非常解除</button>
  </div>
</div>

<script>
let role="";
let emergency=false;
let confirm=false;

const stations=[
  "君津","木更津","巌根","袖ヶ浦","長浦","姉ヶ崎",
  "五井","八幡宿","浜野","蘇我","本千葉","千葉",
  "津田沼","船橋","市川","新小岩","馬喰町",
  "錦糸町","新日本橋","東京"
];

let index=0;
let press=0;

function enterMain(r){
  role=r;
  initial.classList.remove("active");
  main.classList.add("active");
  updateDisplay();
}

function goHome(){
  if(emergency) return;
  main.classList.remove("active");
  initial.classList.add("active");
}

function nextStation(){
  press++;
  fadeUpdate(()=>{
    if(stations[index]==="巌根" && press===1){
      show("次駅：巌根（通過）",true);
    }else{
      if(press>=2){
        showStop();
        index++;
        press=0;
      }
    }
  });
}

function showStop(){
  tempStatus.textContent="停車中";
  setTimeout(()=>tempStatus.textContent="",800);
  updateDisplay();
}

function updateDisplay(){
  const next=stations[index]||"";
  nextStationDiv.innerHTML="";
  nextStationDiv.textContent="次駅："+next;
  threeStations.textContent=
    (stations[index]||"")+" / "+
    (stations[index+1]||"")+" / "+
    (stations[index+2]||"");
  if(next==="巌根"){
    nextStationDiv.innerHTML="次駅：<span class='blueText'>巌根（通過）</span>";
  }
}

function fadeUpdate(fn){
  nextArea.classList.add("fade");
  setTimeout(()=>{
    fn();
    nextArea.classList.remove("fade");
  },200);
}

function semiOn(){
  semiState.textContent="半自動 ON";
  semiState.style.color="#0f0";
}
function semiOff(){
  semiState.textContent="半自動 OFF";
  semiState.style.color="#0f0";
}

function openReason(){
  if(emergency) return;
  reasonOverlay.classList.add("active");
}

function startEmergency(r){
  emergency=true;
  reasonOverlay.classList.remove("active");
  emText.textContent=message(r);
  emergencyOverlay.classList.add("active");
}

function confirmRelease(){
  emergency=false;
  emergencyOverlay.classList.remove("active");
}

function message(r){
  return {
    "人身事故":"直ちに消防・警察・車掌に連絡",
    "地震":"高台避難・指令に報告",
    "線路内侵入":"他列車・警察に連絡",
    "火災":"窓閉鎖・乗客避難・トンネル停車回避"
  }[r];
}
</script>

</body>
</html>
