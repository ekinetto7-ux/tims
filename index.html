<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>運転支援システム</title>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: #000;
  color: #0f0;
}

button {
  font-size: 16px;
  padding: 10px;
  margin: 5px;
}

.top-fixed {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 100;
}

.screen {
  padding: 60px 10px 80px;
}

.hidden {
  display: none;
}

/* 非常表示 */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  color: red;
  display: none;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 999;
  flex-direction: column;
}

.overlay.active {
  display: flex;
}

.big {
  font-size: 22px;
  margin-bottom: 20px;
}

.yellow {
  background: yellow;
  color: black;
  font-size: 18px;
  padding: 15px 25px;
}

/* 操作ロック */
#lockOverlay {
  position: fixed;
  inset: 0;
  z-index: 500;
  display: none;
}

#lockOverlay.active {
  display: block;
}
</style>
</head>

<body>

<!-- 初期選択 -->
<div class="screen" id="initScreen">
  <h2>初期選択</h2>
  <button onclick="openMode('driver')">運転士</button>
  <button onclick="openMode('conductor')">車掌</button>
  <button onclick="openMode('oneMan')">ワンマン</button>
</div>

<!-- 右上固定 -->
<div class="top-fixed hidden" id="homeBtn">
  <button onclick="goHome()">初期選択</button>
</div>

<!-- ワンマン画面 -->
<div class="screen hidden" id="oneManScreen">
  <h3>ワンマン運用</h3>
  <button onclick="showDriveInfo()">運転情報</button>
  <button onclick="showDoor()">ドア開閉</button>
  <button onclick="pressEmergency()">非常</button>
</div>

<!-- 運転情報 -->
<div class="screen hidden" id="driveInfo">
  <h3>運転情報</h3>
  <div id="statusText">平常運転しています</div>
  <div id="nextInfo">次駅：君津</div>
  <button onclick="nextStation()">次駅</button>
  <button onclick="showDoor()">ドア開閉</button>
</div>

<!-- ドア -->
<div class="screen hidden" id="doorScreen">
  <h3>ドア操作</h3>
  <button onclick="setDoor('open')">ドア開</button>
  <button onclick="setDoor('close')">ドア閉</button>
</div>

<!-- 非常メイン -->
<div class="overlay" id="emergencyOverlay">
  <div class="big">非常モードです。<br>安全を確認してください</div>
</div>

<!-- 非常理由 -->
<div class="overlay" id="reasonOverlay">
  <div class="big">非常理由を選択</div>
  <button onclick="selectReason('人身事故')">人身事故</button>
  <button onclick="selectReason('地震')">地震</button>
  <button onclick="selectReason('線路内侵入')">線路内侵入</button>
  <button onclick="selectReason('火災')">火災</button>
</div>

<!-- 指示表示 -->
<div class="overlay" id="instructionOverlay">
  <div class="big" id="instructionText"></div>
  <button onclick="confirmRelease()" class="yellow">非常解除</button>
</div>

<div id="lockOverlay"></div>

<script>
const stations = [
  "君津","木更津","袖ヶ浦","長浦","姉ヶ崎","五井",
  "八幡宿","浜野","蘇我","本千葉","千葉",
  "津田沼","船橋","市川","新小岩",
  "馬喰町","新日本橋","東京"
];

let index = 0;
let emergency = false;

const instructionMap = {
  "人身事故":"直ちに、消防、警察、車掌に連絡すること",
  "地震":"直ちに高台に避難すること。車掌と連携し指令に報告",
  "線路内侵入":"直ちに他の列車に連絡。警察にも連絡",
  "火災":"窓を全て閉め、乗客を安全な場所へ避難。トンネル内停車を避ける"
};

function openMode(mode){
  hideAll();
  document.getElementById("homeBtn").classList.remove("hidden");
  if(mode==="oneMan") oneManScreen.classList.remove("hidden");
}

function goHome(){
  hideAll();
  initScreen.classList.remove("hidden");
  homeBtn.classList.add("hidden");
}

function hideAll(){
  document.querySelectorAll(".screen").forEach(s=>s.classList.add("hidden"));
}

function showDriveInfo(){
  hideAll();
  driveInfo.classList.remove("hidden");
}

function showDoor(){
  hideAll();
  doorScreen.classList.remove("hidden");
}

function nextStation(){
  if(index < stations.length-1){
    index++;
    document.getElementById("nextInfo").textContent =
      index < stations.length-1
      ? "次駅：" + stations[index]
      : "終点：東京";
  }
}

function setDoor(state){
  alert("ドア：" + (state==="open"?"開":"閉"));
}

function pressEmergency(){
  emergency = true;
  emergencyOverlay.classList.add("active");
  reasonOverlay.classList.add("active");
  lockOverlay.classList.add("active");
  document.getElementById("statusText").textContent = "非常扱い";
}

function selectReason(r){
  reasonOverlay.classList.remove("active");
  instructionText.textContent = instructionMap[r];
  instructionOverlay.classList.add("active");
}

function confirmRelease(){
  emergency = false;
  emergencyOverlay.classList.remove("active");
  instructionOverlay.classList.remove("active");
  lockOverlay.classList.remove("active");
  document.getElementById("statusText").textContent = "平常運転しています";
}

/* ★ 初期化（重要） */
window.onload = ()=>{
  emergency = false;
  document.querySelectorAll(".overlay").forEach(o=>o.classList.remove("active"));
  lockOverlay.classList.remove("active");
};
</script>

</body>
</html>
