<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>運転情報システム</title>

<style>
body{margin:0;font-family:sans-serif;background:#000;color:#fff}
.screen{display:none;padding:20px}
.screen.active{display:block}

button{border:none;border-radius:6px;cursor:pointer}
.btn{background:#333;color:#fff;padding:12px 18px;margin:6px}
.btn.big{font-size:18px;padding:16px 22px}
.btn.yellow{background:#facc15;color:#000;font-weight:800}
.btn.red{background:red;color:#fff}

/* 初期選択固定 */
.fixed-home-btn{
  position:fixed;
  top:10px;
  right:10px;
  z-index:3000;
}

/* 運転情報 */
.op-status{font-size:18px;margin-bottom:10px}
.op-status.normal{color:#0f0}
.op-status.emergency{color:red;font-weight:900}

/* 次駅・走行 */
#nextStation{font-size:26px;color:#facc15;font-weight:800;display:none}
#runningSection{font-size:22px;color:#facc15;display:none}
#runningArrow{font-size:28px;color:#facc15;display:none}
.blink-arrow{animation:blink 1s step-start infinite}
@keyframes blink{50%{opacity:0}}

#stopDisplay{
  font-size:28px;
  color:#facc15;
  font-weight:800;
}

/* overlay */
.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  z-index:2000;
  align-items:center;
  justify-content:center;
}
.overlay.active{display:flex}
.overlay-box{text-align:center}

/* 非常表示 */
#emergencyOverlayText{
  color:red;
  font-size:26px;
  font-weight:900;
  animation:blink 1s step-start infinite;
}
#emergencyDetailText{
  color:red;
  font-size:22px;
  font-weight:800;
  margin-top:20px;
  line-height:1.6;
}

/* ロック */
#lockOverlay{
  position:fixed;inset:0;
  display:none;z-index:2500;
}
#lockOverlay.active{display:block;pointer-events:all}

/* 非常履歴 */
#logBox{
  margin-top:20px;
  border-top:1px solid #555;
  padding-top:10px;
  font-size:14px;
}
.log-item{margin-bottom:10px}
</style>
</head>

<body>

<!-- 固定 初期選択 -->
<div class="fixed-home-btn">
  <button class="btn" onclick="goHome()">初期選択</button>
</div>

<!-- 初期選択 -->
<div id="home" class="screen active">
  <h2>初期選択</h2>
  <button class="btn big" onclick="openOp()">運転士</button>
  <button class="btn big" onclick="openOp()">車掌</button>
  <button class="btn big" onclick="openOp()">ワンマン</button>
</div>

<!-- 運転情報 -->
<div id="op" class="screen">
  <div id="opStatus" class="op-status normal">
    平常運転しています
  </div>

  <div id="stopDisplay">君津<br><span style="font-size:20px">停車中</span></div>
  <div id="nextStation"></div>
  <div id="runningSection"></div>
  <div id="runningArrow">▶▶▶</div>

  <div style="position:absolute;bottom:20px;right:20px">
    <button class="btn big" onclick="nextStation()">次駅</button>
    <button class="btn red big" onclick="emergencyPress()">非常</button>
  </div>

  <div id="logBox"></div>
</div>

<!-- 非常理由 -->
<div id="emergencyReasonOverlay" class="overlay">
  <div class="overlay-box">
    <h2 style="color:red">非常理由を選択してください</h2>
    <button class="btn big red" onclick="selectEmergencyReason('人身事故')">人身事故</button>
    <button class="btn big red" onclick="selectEmergencyReason('地震')">地震</button>
    <button class="btn big red" onclick="selectEmergencyReason('線路内立ち入り')">線路内立ち入り</button>
    <button class="btn big red" onclick="selectEmergencyReason('火災')">火災</button>
  </div>
</div>

<!-- 非常中 -->
<div id="emergencyOverlay" class="overlay">
  <div class="overlay-box">
    <div id="emergencyOverlayText">
      非常モードです。<br>安全を確認してください
    </div>
    <div id="emergencyDetailText"></div>
  </div>
</div>

<!-- 非常解除 -->
<div id="confirmOverlay" class="overlay">
  <div class="overlay-box">
    <div>非常を解除します。よろしいですか</div>
    <button class="btn yellow big" onclick="releaseEmergency()">非常解除</button>
  </div>
</div>

<div id="lockOverlay"></div>

<script>
const stations=[
  "君津","木更津","袖ヶ浦","長浦","姉ヶ崎",
  "五井","八幡宿","浜野","蘇我","本千葉",
  "千葉","津田沼","船橋","市川","新小岩",
  "馬喰町","新日本橋","東京"
];

let stationIndex=0;   // 出発：君津
let running=false;
let emergency=false;
let logs=[];

function now(){
  const d=new Date();
  return d.getHours().toString().padStart(2,'0')+":"+
         d.getMinutes().toString().padStart(2,'0');
}

function openOp(){
  home.classList.remove('active');
  op.classList.add('active');
}
function goHome(){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  home.classList.add('active');
}

function nextStation(){
  if(emergency) return;

  if(running){
    running=false;
    runningSection.style.display='none';
    runningArrow.style.display='none';
    stopDisplay.style.display='block';
    stopDisplay.innerHTML=
      stations[stationIndex]+'<br><span style="font-size:20px">停車中</span>';
    return;
  }

  if(stationIndex < stations.length-1){
    stopDisplay.style.display='none';
    running=true;
    nextStationDiv.style.display='block';
    nextStationDiv.textContent='次は　'+stations[stationIndex+1];
    runningSection.style.display='block';
    runningSection.textContent=
      stations[stationIndex]+' → '+stations[stationIndex+1];
    runningArrow.style.display='block';
    runningArrow.className='blink-arrow';
    stationIndex++;
  }
}

function emergencyPress(){
  if(emergency){
    confirmOverlay.classList.add('active');
    return;
  }
  emergencyReasonOverlay.classList.add('active');
}

function selectEmergencyReason(reason){
  emergency=true;
  emergencyReasonOverlay.classList.remove('active');
  emergencyOverlay.classList.add('active');
  lockOverlay.classList.add('active');

  const messages={
    "人身事故":"直ちに、消防、警察、車掌に連絡すること",
    "地震":"直ちに高台に避難すること<br>車掌と連携すること<br>指令に報告",
    "線路内立ち入り":"直ちに、他の列車に連絡<br>警察にも連絡",
    "火災":"直ちに、閉められる窓は全て閉める<br>乗客を安全なところに避難させる<br>トンネル内停車を避けること"
  };
  emergencyDetailText.innerHTML=messages[reason];

  logs.unshift({
    time:now(),
    reason,
    section:stations[stationIndex],
    state:running?"走行中":"停車中"
  });

  opStatus.textContent="非常扱い（"+reason+"）";
  opStatus.className="op-status emergency";
  renderLog();
}

function releaseEmergency(){
  emergency=false;
  confirmOverlay.classList.remove('active');
  emergencyOverlay.classList.remove('active');
  lockOverlay.classList.remove('active');
  emergencyDetailText.innerHTML="";
  opStatus.textContent="平常運転しています";
  opStatus.className="op-status normal";
}

function renderLog(){
  logBox.innerHTML="";
  logs.forEach(l=>{
    const d=document.createElement("div");
    d.className="log-item";
    d.innerHTML=
      l.time+" 非常発生（"+l.reason+"）<br>"+
      "駅："+l.section+"<br>"+
      "状態："+l.state;
    logBox.appendChild(d);
  });
}

/* DOM */
const home=document.getElementById("home");
const op=document.getElementById("op");
const nextStationDiv=document.getElementById("nextStation");
const runningSection=document.getElementById("runningSection");
const runningArrow=document.getElementById("runningArrow");
const stopDisplay=document.getElementById("stopDisplay");
const emergencyReasonOverlay=document.getElementById("emergencyReasonOverlay");
const emergencyOverlay=document.getElementById("emergencyOverlay");
const confirmOverlay=document.getElementById("confirmOverlay");
const lockOverlay=document.getElementById("lockOverlay");
const opStatus=document.getElementById("opStatus");
const logBox=document.getElementById("logBox");
const emergencyDetailText=document.getElementById("emergencyDetailText");
</script>

</body>
</html>
