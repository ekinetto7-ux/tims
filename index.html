<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>運転支援システム</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:sans-serif;
}

/* 固定ボタン */
#homeBtn{
  position:fixed;
  top:10px;
  right:10px;
  z-index:1000;
  padding:14px 22px;
  font-size:20px;
}

/* 画面 */
.screen{
  display:none;
  height:100vh;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.screen.active{display:flex;}

/* 路線表示 */
#route{
  font-size:28px;
  margin-bottom:15px;
}

/* 次駅 */
#nextStation{
  font-size:44px;
  margin:20px;
  color:yellow;
  transition:opacity .15s;
}

/* 3駅表示 */
#stationList{
  font-size:24px;
  line-height:1.7;
  color:#fff;
  margin-bottom:20px;
}

/* ボタン共通 */
button{
  cursor:pointer;
  margin:10px;
}

/* 初期選択（特大） */
.startBtn{
  font-size:32px;
  padding:28px 60px;
}

/* 通常大 */
.bigBtn{
  font-size:26px;
  padding:22px 44px;
}

.red{
  background:#c00;
  color:#fff;
}
.yellow{
  background:#ffd800;
  color:#000;
}

/* 非常 */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:500;
}
.overlay.active{display:flex;}

.box{
  border:2px solid red;
  padding:30px;
  max-width:600px;
  text-align:center;
}

.reasonBtn{
  font-size:26px;
  padding:18px 36px;
  margin:10px;
}

.redText{
  color:red;
  font-size:26px;
}
.blue{color:#4aa3ff;}
</style>
</head>

<body>

<button id="homeBtn" onclick="goHome()">初期選択</button>

<!-- 初期画面 -->
<div id="initial" class="screen active">
  <h2>初期選択</h2>
  <button class="startBtn" onclick="enterMain()">運転士</button>
  <button class="startBtn" onclick="enterMain()">車掌</button>
  <button class="startBtn" onclick="enterMain()">ワンマン</button>
</div>

<!-- メイン -->
<div id="main" class="screen">
  <div id="route">内房線・総武快速線（君津 → 東京）</div>

  <div id="nextStation"></div>
  <div id="stationList"></div>

  <button class="bigBtn" onclick="nextStation()">次駅</button>
  <button class="bigBtn red" onclick="openReason()">非常</button>
</div>

<!-- 非常理由 -->
<div id="reason" class="overlay">
  <div class="box">
    <p class="redText">非常理由を選択</p>
    <button class="reasonBtn" onclick="startEmergency('人身事故')">人身事故</button>
    <button class="reasonBtn" onclick="startEmergency('地震')">地震</button>
    <button class="reasonBtn" onclick="startEmergency('線路内侵入')">線路内侵入</button>
    <button class="reasonBtn" onclick="startEmergency('火災')">火災</button>
  </div>
</div>

<!-- 非常中 -->
<div id="emergency" class="overlay">
  <div class="box">
    <p id="emText" class="redText"></p>
    <button class="bigBtn yellow" onclick="releaseEmergency()">非常解除</button>
  </div>
</div>

<script>
/* 駅データ */
const stations = [
 {n:"君津",s:true},
 {n:"木更津",s:true},
 {n:"巌根",s:false},
 {n:"袖ヶ浦",s:true},
 {n:"長浦",s:true},
 {n:"姉ヶ崎",s:true},
 {n:"五井",s:true},
 {n:"八幡宿",s:true},
 {n:"浜野",s:true},
 {n:"蘇我",s:true},
 {n:"本千葉",s:true},
 {n:"千葉",s:true},
 {n:"津田沼",s:true},
 {n:"船橋",s:true},
 {n:"市川",s:true},
 {n:"新小岩",s:true},
 {n:"馬喰町",s:true},
 {n:"錦糸町",s:true},
 {n:"新日本橋",s:true},
 {n:"東京",s:true}
];

let idx = 0;
let phase = 0;
let emergency = false;

/* 初期表示 */
renderStations();

/* 次駅ボタン */
function nextStation(){
 if(emergency || idx >= stations.length) return;

 blink();

 const st = stations[idx];

 if(!st.s){
   setTimeout(()=>{
     showNext(st.n+"（通過）","blue");
     idx++;
     renderStations();
   },150);
   return;
 }

 if(phase===0){
   setTimeout(()=>{
     showNext(st.n,"yellow");
     phase=1;
   },150);
 }else{
   setTimeout(()=>{
     showNext("停車中","#fff");
     idx++;
     phase=0;
     renderStations();
   },150);
 }
}

/* 表示更新（★ここが直った） */
function renderStations(){
 const a = stations[idx]?.n || "終点";
 const b = stations[idx+1]?.n || "";
 const c = stations[idx+2]?.n || "";

 document.getElementById("nextStation").textContent = a;
 document.getElementById("nextStation").style.color = "yellow";

 document.getElementById("stationList").innerHTML =
   `<div>${a}</div><div>${b}</div><div>${c}</div>`;
}

/* 表示補助 */
function showNext(t,c){
 const e=document.getElementById("nextStation");
 e.textContent=t;
 e.style.color=c;
}
function blink(){
 const e=document.getElementById("nextStation");
 e.style.opacity=0;
 setTimeout(()=>e.style.opacity=1,80);
}

/* 画面遷移 */
function enterMain(){
 document.getElementById("initial").classList.remove("active");
 document.getElementById("main").classList.add("active");
}
function goHome(){
 if(emergency) return;
 document.getElementById("main").classList.remove("active");
 document.getElementById("initial").classList.add("active");
}

/* 非常 */
function openReason(){
 if(emergency) return;
 document.getElementById("reason").classList.add("active");
}
function startEmergency(r){
 emergency=true;
 document.getElementById("reason").classList.remove("active");
 document.getElementById("emergency").classList.add("active");
 document.getElementById("emText").textContent =
   r+"："+
   ({
     "人身事故":"直ちに消防・警察・車掌に連絡",
     "地震":"高台へ避難、車掌・指令と連携",
     "線路内侵入":"他列車・警察に連絡",
     "火災":"窓を閉め避難、トンネル内停車回避"
   })[r];
}
function releaseEmergency(){
 emergency=false;
 document.getElementById("emergency").classList.remove("active");
}
</script>

</body>
</html>
