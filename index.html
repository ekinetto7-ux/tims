<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>運転情報システム</title>
<style>
body{margin:0;font-family:sans-serif;background:#000;color:#fff}
.screen{display:none;padding:20px}
.screen.active{display:block}
button{border:none;border-radius:6px;cursor:pointer}
.btn{background:#333;color:#fff;padding:12px 18px;margin:6px}
.btn.big{font-size:18px;padding:16px 22px}
.btn.yellow{background:#facc15;color:#000;font-weight:800}
.btn.red{background:red;color:#fff}
.top-right{position:absolute;top:10px;right:10px}
.bottom-right{position:absolute;bottom:20px;right:20px}

/* 運転情報 */
.op-status{font-size:18px;margin-bottom:10px}
.op-status.emergency{color:red;font-weight:800}
.op-status.normal{color:#0f0}

/* 次駅・走行表示 */
#nextStation{font-size:26px;color:#facc15;font-weight:800;display:none}
#runningSection{font-size:22px;color:#facc15;display:none}
#runningArrow{font-size:28px;color:#facc15;display:none}
.blink-arrow{animation:blink 1s step-start infinite}
@keyframes blink{50%{opacity:0}}
#stopDisplay{display:none;font-size:28px;color:#facc15;font-weight:800}

/* overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;z-index:1000;align-items:center;justify-content:center}
.overlay.active{display:flex}
.overlay-box{text-align:center}

/* 非常表示 */
#emergencyOverlayText{color:red;font-size:26px;font-weight:900;animation:blink 1s step-start infinite}

/* 操作ロック */
#lockOverlay{position:fixed;inset:0;display:none;z-index:900}
#lockOverlay.active{display:block;pointer-events:all}

/* 非常履歴 */
#logBox{margin-top:20px;border-top:1px solid #555;padding-top:10px;font-size:14px}
.log-item{margin-bottom:10px}
</style>
</head>

<body>

<!-- 初期選択 -->
<div id="home" class="screen active">
  <h2>初期選択</h2>
  <button class="btn big" onclick="openOp()">運転士</button>
  <button class="btn big" onclick="openOp()">車掌</button>
  <button class="btn big" onclick="openOp()">ワンマン</button>
</div>

<!-- 運転情報画面 -->
<div id="op" class="screen">
  <div class="top-right">
    <button class="btn" onclick="goHome()">初期</button>
  </div>

  <div id="opStatus" class="op-status normal">平常運転しています</div>

  <div id="nextStation"></div>
  <div id="runningSection"></div>
  <div id="runningArrow">▶▶▶</div>
  <div id="stopDisplay"></div>

  <div class="bottom-right">
    <button class="btn big" onclick="nextStation()">次駅</button>
    <button class="btn red big" onclick="emergencyPress()">非常</button>
  </div>

  <!-- 非常履歴 -->
  <div id="logBox"></div>
</div>

<!-- 非常理由選択 -->
<div id="emergencyReasonOverlay" class="overlay">
  <div class="overlay-box">
    <h2 style="color:red">非常理由を選択してください</h2>
    <button class="btn big red" onclick="selectEmergencyReason('人身事故')">人身事故</button>
    <button class="btn big red" onclick="selectEmergencyReason('線路内立ち入り')">線路内立ち入り</button>
    <button class="btn big red" onclick="selectEmergencyReason('地震')">地震</button>
    <button class="btn big red" onclick="selectEmergencyReason('火災')">火災</button>
  </div>
</div>

<!-- 非常表示 -->
<div id="emergencyOverlay" class="overlay">
  <div id="emergencyOverlayText">
    非常モードです。<br>安全を確認してください
  </div>
</div>

<!-- 非常解除 -->
<div id="confirmOverlay" class="overlay">
  <div class="overlay-box">
    <div style="margin-bottom:10px">非常を解除します。よろしいですか</div>
    <button class="btn yellow big" onclick="releaseEmergency()">非常解除</button>
  </div>
</div>

<div id="lockOverlay"></div>

<script>
const stations=[
  "君津","木更津","袖ヶ浦","長浦","姉ヶ崎",
  "五井","八幡宿","浜野","蘇我","本千葉",
  "千葉","津田沼","船橋","市川","新小岩",
  "馬喰町","新日本橋","東京"
];

let stationIndex=-1;
let running=false;
let emergency=false;
let logs=[];

function now(){
  const d=new Date();
  return d.getHours().toString().padStart(2,'0')+':'+
         d.getMinutes().toString().padStart(2,'0');
}

function openOp(){
  home.classList.remove('active');
  op.classList.add('active');
}
function goHome(){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  home.classList.add('active');
}

function nextStation(){
  if(emergency) return;

  const next=nextStationDiv;
  const sec=runningSection;
  const arr=runningArrow;
  const stop=stopDisplay;

  if(running){
    running=false;
    sec.style.display='none';
    arr.style.display='none';
    stop.style.display='block';
    stop.innerHTML=stations[stationIndex]+'<br><span style="font-size:20px">停車中</span>';
    return;
  }

  if(stationIndex<stations.length-1) stationIndex++;
  running=true;

  stop.style.display='none';
  next.style.display='block';
  next.textContent='次は　'+stations[stationIndex];

  if(stationIndex<stations.length-1){
    sec.style.display='block';
    sec.textContent=stations[stationIndex]+' → '+stations[stationIndex+1];
    arr.style.display='block';
    arr.className='blink-arrow';
  }
}

function emergencyPress(){
  if(emergency){
    confirmOverlay.classList.add('active');
    return;
  }
  emergencyReasonOverlay.classList.add('active');
}

function selectEmergencyReason(reason){
  emergency=true;
  emergencyReasonOverlay.classList.remove('active');
  emergencyOverlay.classList.add('active');
  lockOverlay.classList.add('active');

  let section,state;
  if(stationIndex===-1){
    section='発車前';
    state='停車中';
  }else if(running && stationIndex<stations.length-1){
    section=stations[stationIndex]+' → '+stations[stationIndex+1];
    state='走行中';
  }else{
    section=stations[stationIndex]+'（停車中）';
    state='停車中';
  }

  logs.unshift({
    time:now(),
    reason,
    section,
    state
  });

  opStatus.textContent='非常扱い（'+reason+'）';
  opStatus.className='op-status emergency';
  renderLog();
}

function releaseEmergency(){
  emergency=false;
  confirmOverlay.classList.remove('active');
  emergencyOverlay.classList.remove('active');
  lockOverlay.classList.remove('active');

  opStatus.textContent='平常運転しています';
  opStatus.className='op-status normal';
}

function renderLog(){
  logBox.innerHTML='';
  logs.forEach(l=>{
    const d=document.createElement('div');
    d.className='log-item';
    d.innerHTML=
      l.time+' 非常発生（'+l.reason+'）<br>'+
      '区間：'+l.section+'<br>'+
      '状態：'+l.state;
    logBox.appendChild(d);
  });
}

/* DOM shortcut */
const home=document.getElementById('home');
const op=document.getElementById('op');
const nextStationDiv=document.getElementById('nextStation');
const runningSection=document.getElementById('runningSection');
const runningArrow=document.getElementById('runningArrow');
const stopDisplay=document.getElementById('stopDisplay');
const emergencyReasonOverlay=document.getElementById('emergencyReasonOverlay');
const emergencyOverlay=document.getElementById('emergencyOverlay');
const confirmOverlay=document.getElementById('confirmOverlay');
const lockOverlay=document.getElementById('lockOverlay');
const opStatus=document.getElementById('opStatus');
const logBox=document.getElementById('logBox');
</script>
</body>
</html>
